import unittest
from TumOnc.critstat import critstat
import numpy as np

class test_critstat(unittest.TestCase):
    def test_pvals3(self):
        pv = np.array([  2.60462718e-03,   2.60411162e-03,   2.44170909e-03,
                         2.30920925e-03,   2.22878134e-03,   2.13597989e-03,
                         1.93078559e-03,   1.90088290e-03,   1.89521170e-03,
                         1.86840240e-03,   1.76786750e-03,   1.76786750e-03,
                         1.76168074e-03,   1.63124315e-03,   1.59824708e-03,
                         1.57453116e-03,   1.51730360e-03,   1.36675904e-03,
                         1.36057228e-03,   1.35747889e-03,   1.32602952e-03,
                         1.30334472e-03,   1.30334472e-03,   1.28684668e-03,
                         1.14197332e-03,   1.08680802e-03,   1.05278082e-03,
                         1.05071857e-03,   1.02339370e-03,   9.84726429e-04,
                         9.65135013e-04,   9.64619450e-04,   9.50183670e-04,
                         9.45543597e-04,   8.35212992e-04,   7.59425147e-04,
                         7.58394019e-04,   6.47547851e-04,   6.24347490e-04,
                         6.17645163e-04,   6.07333892e-04,   5.36701682e-04,
                         5.36186118e-04,   4.87207579e-04,   4.81536379e-04,
                         4.55758201e-04,   4.32557840e-04,   3.95952826e-04,
                         3.64503448e-04,   3.34600760e-04,   3.33569633e-04,
                         3.08822582e-04,   2.92324547e-04,   2.17567829e-04,
                         2.00038667e-04,   1.90758523e-04,   1.46420055e-04,
                         1.12392859e-04,   1.10330605e-04,   7.78500999e-05,
                         5.05252304e-05,   4.69162854e-05,   2.78404331e-05,
                         1.03112715e-06])
        cs = critstat(1, pv)
        self.assertEqual( cs.pvalue3([1,2,63]), 5.361238059928237e-09)
                          # 5.361238064004364e-09)

    def test_guessp(self):
        f = np.ones(10)
        l = [3, 6, 7]
        cs = critstat(1, f)
        n = len(l)
        Nn = len(f)-n
        self.assertEqual(cs.guessp(l), (np.sqrt(Nn*Nn+4*n*Nn)-Nn)/(2*Nn) )
            
if __name__ == '__main__':
    unittest.main()
